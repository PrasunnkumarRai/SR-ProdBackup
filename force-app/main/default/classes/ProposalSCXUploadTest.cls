/**
 * This class contains unit tests for validating the behavior of Apex classes
 * and triggers.
 *
 * Unit tests are class methods that verify whether a particular piece
 * of code is working properly. Unit test methods take no arguments,
 * commit no data to the database, and are flagged with the testMethod
 * keyword in the method definition.
 *
 * All test methods in an organization are executed whenever Apex code is deployed
 * to a production organization to confirm correctness, ensure code
 * coverage, and prevent regressions. All Apex classes are
 * required to have at least 75% code coverage in order to be deployed
 * to a production organization. In addition, all triggers must have some code coverage.
 * 
 * The @isTest class annotation indicates this class only contains test
 * methods. Classes defined with the @isTest annotation do not count against
 * the organization size limit for all Apex scripts.
 *
 * See the Apex Language Reference for more information about Testing and Code Coverage.
 */
@isTest
private class ProposalSCXUploadTest {

    @testSetup
    static void prepareTestData() {
        User u = TestDataHelper.createSystemAdminUser(true);
        User boomiUser = TestDataHelper.getBoomiIntegrationUser();
        System.debug(' ### user ::: ' +u.Id);
        System.runAs(u){
            List<Account> accList = new List<Account>();
            Id repFirmRecTypeId = [SELECT Id FROM RecordType WHERE DeveloperName='Rep_Firm' AND SobjectType = 'Account' LIMIT 1].Id;
            Id agencyRecTypeId = [SELECT Id FROM RecordType WHERE DeveloperName='Agency_Account' AND SobjectType = 'Account' LIMIT 1].Id;
            //Create an account
            Account acc=TestDataHelper.createAdvertiser('Test Advertiser Account','123 Wright Plaza', 'Hyderabad', 'Andhra Pradesh', '500084', 'India');
            accList.add(acc);
            System.assert(acc != null);

            Account politicalAcc = TestDataHelper.createAdvertiser('Test Advertiser Account','123 Wright Plaza', 'Hyderabad', 'Andhra Pradesh', '500084', 'India');
            politicalAcc.Commodity_Codes__c = 'POLITICL -- Local- Republican';
            politicalAcc.Primary_Commodity__c = 'Political';
            accList.add(politicalAcc);
            System.assert(politicalAcc != null);


            //insert agency;
            Account agencyAcc = TestDataHelper.createAgency('Test Agency Account', 'Manikonda', 'Hyderabad', 'Andhra Pradesh', '500084', 'India');
            accList.add(agencyAcc);

            // Insert RepFirm
            Account repFirmAcc = TestDataHelper.createAcc('RepFirm Account', 'Ameerpet', 'Hyderabad', 'Andhra Pradesh', '500084', 'India');                        
            repFirmAcc.RecordTypeId = repFirmRecTypeId;
            accList.add(repFirmAcc);

            insert accList;
            Id agencyId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Agency_Account' LIMIT 1].Id;
            Id repFirmId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Rep_Firm' LIMIT 1].Id;
            Id advertiserId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Advertiser_Account' AND Political_Account__c = false LIMIT 1].Id;
            Id politicalAdvertiserId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Advertiser_Account' AND Political_Account__c = true LIMIT 1].Id;

            TestDataHelper.createTIMIntegrationCustomSettings();

            //Create an opportunity
            List<Opportunity> oppList = new List<Opportunity>();
            Opportunity opp = TestDataHelper.createopportunity('Test Opportunity',System.today(),'Planning','Pipeline',advertiserId);
            //opp.Rep_Firm__c=repFirmAcc.Id;
            opp.Agency_Account__c = agencyId;
            opp.OwnerId = u.Id;       
            oppList.add(opp);

            Opportunity opp1 = TestDataHelper.createopportunity('Test Opportunity1',System.today(),'Planning','Pipeline',politicalAdvertiserId);
            opp.Rep_Firm__c=repFirmAcc.Id;
            opp1.Agency_Account__c = agencyId;
            opp1.OwnerId = u.Id;       
            oppList.add(opp1);
            insert oppList;

/*            List<Opportunity> opporList = [SELECT ID, Agency_Account__c from Opportunity WHERE Agency_Account__c = null];
            for(Opportunity oppor : opporList) {
                oppor.Agency_Account__c = agencyId;
            }
            update opporList;*/
            // opp.Rep_Firm__c = repFirmId;
            //opp.Agency_Account__c = agency.Id; 
            // insert opp;

            System.debug(' ### opportunity Owner ::: ' +opp.OwnerId);
            System.debug(' ### opp agency ::: ' +opp.Agency_Account__c);
            System.assert(opp != null);

            List<UserConnection__c> usrConnList = new List<UserConnection__c>();
            /*UserConnection__c uCon = TestDataHelper.createUserConnection('St. Louis Local','SFDCUser',UserInfo.getUserId(),'TIM','1');
            uCon.Is_Primary__c = false;
            usrConnList.add(uCon);*/
            // insert uCon;
            // System.assert(uCon != null);
            UserConnection__c uCon1 = TestDataHelper.createUserConnection('St. Louis Local','SFDCUser',UserInfo.getUserId(),'TIM','1');
            uCon1.Is_Primary__c = true;
            usrConnList.add(uCon1);
            // insert uCon1;

            insert usrConnList;

            List<AccountConnection__c> accConnList = new List<AccountConnection__c>();

            AccountConnection__c agencyCon = TestDataHelper.createAccountConnection(repFirmId);
            agencyCon.AgencyTIMId__c = '1';
            accConnList.add(agencyCon);

            AccountConnection__c accCon = TestDataHelper.createAccountConnection(advertiserId);
            accCon.AgencyTIMId__c = '1';
            accConnList.add(accCon);

            insert accConnList;

            /*Common_Setting__mdt accountConnMT = new Common_Setting__mdt();
            accountConnMT.Condition_Enable__c = true;
            accountConnMT.Name = '';*/

        }
    }

    static testMethod void ProposalSCXUploadTestWithoutAdvertiser() {
        // TO DO: implement unit test
        // User u = TestDataHelper.getBoomiIntegrationUser();
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){
            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() and TIM_System__c ='St. Louis Local' LIMIT 1];

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);

            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            
            String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', oppId);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            ApexPages.currentPage().getParameters().put('recType','_LR');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            // BoomiWebServiceMock.name = 'ProposalSCXUpload';
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(oppId);
            //prop.execute(); 
            propController.uploadedFile =Blob.valueOf('<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name></name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency" role=""><name>THE TOLAND GROUP INC - AGY38598</name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name></name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc>Hello SCX Order</desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>');
           
           /* Attachment attach = new Attachment();
            attach.Body = propController.uploadedFile;
            attach.ParentId = oppId;
            attach.Name = 'SCX File Upload';
            insert attach;

            propController.attachmentId = attach.Id;
*/
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            propController.complete();
            // propController.initiateProcess();
            Test.StopTest();
           
            //Test.StartTest();
            
        }
    }

    static testMethod void ProposalSCXUploadTestWithAdvertiser() {
        // TO DO: implement unit test
        // User u = TestDataHelper.getBoomiIntegrationUser();
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){

            Id agencyId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Agency_Account' LIMIT 1].Id;

            // Proposal__c proposal = new Proposal__c();
            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c,OwnerId FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1];
            opp.Agency_Account__c = agencyId;
            // opp.Rep_Firm__c = repFirmId;
            update opp;

            System.debug(' #### opp agency :::: ' +opp.Agency_Account__c);
            System.debug(' #### opp agency :::: ' +opp.Rep_Firm__c);

            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() AND TIM_System__c ='St. Louis Local' LIMIT 1];

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);

            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            // String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            ApexPages.currentPage().getParameters().put('recType','_INV');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            // BoomiWebServiceMock.name = 'ProposalSCXUpload';
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            String xmlStringToProcess = '<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name>RepFirm Test</name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name><![CDATA[THE TOLAND GROUP INC - AGY38598]]></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name>101 Market - 14510</name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc></desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>';
            //prop.execute(); 
            propController.mergeAccountDetailsToSCX(xmlStringToProcess);
            propController.uploadedFile = Blob.valueOf(xmlStringToProcess);
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            Test.StopTest();
           
            //Test.StartTest();
            
        }
    }

    static testMethod void ProposalSCXUploadTestWithoutRep_WithoutAgency() {
         
        // TO DO: implement unit test
        // User u = TestDataHelper.getBoomiIntegrationUser();
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){

            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() AND TIM_System__c ='St. Louis Local' LIMIT 1];

            UserConnection__c uCon = TestDataHelper.createUserConnection('St. Louis Local','SFDCUser',UserInfo.getUserId(),'TIM','1');
            uCon.Is_Primary__c = false;
            // usrConnList.add(uCon);
            insert uCon;

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);

            Id repFirmId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Rep_Firm' LIMIT 1].Id;
            Proposal__c proposal = new Proposal__c();

            List<AccountConnection__c> accountConnList = new List<AccountConnection__c>();
            accountConnList = [SELECT Id, Name, AgencyTIMId__c, Tim_ID__c, Account__c FROM AccountConnection__c LIMIT 2];
            delete accountConnList;
            System.debug(' @@@ accountConnList ::: ' +accountConnList);
            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1];
            opp.Rep_Firm__c = repFirmId;
            update opp;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','true');
            ApexPages.currentPage().getParameters().put('recType','');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            // BoomiWebServiceMock.name = 'ProposalSCXUpload';
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            //prop.execute(); 
            propController.uploadedFile =Blob.valueOf('<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order import tesing files</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep" role="Rep"><name/><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name><![CDATA[Bernstein-Rein Advertising Inc]]></name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>');
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            Id advertiserId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Advertiser_Account' AND Political_Account__c = false LIMIT 1].Id;
            Delete [SELECT Id FROM AccountConnection__c WHERE Account__c =: advertiserId];
            propController.timServiceCall();
            Test.StopTest();
           
            //Test.StartTest();
            
        }
    }

    static testMethod void ProposalSCXUploadTestWithRep_WithoutAgency() {
        // TO DO: implement unit test
        // User u = TestDataHelper.getBoomiIntegrationUser();
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){
            List<UserConnection__c> loggedInUser = new List<UserConnection__c>([SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE TIM_System__c ='St. Louis Local']); // User__c=: UserInfo.getUserId() and 
            delete loggedInUser;

           /* String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);*/

            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', oppId);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            // ApexPages.currentPage().getParameters().put('recType','_PR');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            // BoomiWebServiceMock.name = 'ProposalSCXUpload';
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(oppId);
            //prop.execute(); 
            propController.uploadedFile =Blob.valueOf('<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep" role="TestRole"><name><![CDATA[Rep Firm Test]]></name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name/><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name/><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc/><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost>1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>');
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            Test.StopTest();
           
            //Test.StartTest();
            
        }
    }

    static testMethod void ProposalSCXUploadTestWithPoliticalAdvertiser() {
        // TO DO: implement unit test
        // User u = TestDataHelper.getBoomiIntegrationUser();
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){
            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() AND TIM_System__c ='St. Louis Local' LIMIT 1];

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);
            Id agencyId = [SELECT Id FROM Account WHERE RecordType.DeveloperName = 'Agency_Account' LIMIT 1].Id;
            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c FROM Opportunity WHERE Name = 'Test Opportunity1' AND PoliticalOpportunity__c = true LIMIT 1];
            opp.Agency_Account__c = agencyId;
            update opp;

            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','true');
            ApexPages.currentPage().getParameters().put('recType','');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            // BoomiWebServiceMock.name = 'ProposalSCXUpload';
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            String xmlStringToProcess = '<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name>RepFirm Test</name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name><![CDATA[THE TOLAND GROUP INC - AGY38598]]></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name>101 Market - 14510</name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc></desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>';
            //prop.execute(); 
            propController.mergeAccountDetailsToSCX(xmlStringToProcess);
            propController.uploadedFile = Blob.valueOf(xmlStringToProcess);
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            Test.StopTest();
           
            //Test.StartTest();
            
        }
    }

    static testMethod void rateCards() {
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        Ratecard__c rc1 = new Ratecard__c(RateCard_Id__c ='123',Name='RateCard 1',Syscode__c='123|3456|0397|6789',TIM_System__c ='St. Louis Local',Active__c=TRUE,RateCardExternalId__c ='123 St. Louis Local');
        insert rc1;
        System.runAs(u){

            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c,OwnerId FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1];
            
            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() AND TIM_System__c ='St. Louis Local' LIMIT 1];

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);

            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            // String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            ApexPages.currentPage().getParameters().put('recType','_INV');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            String xmlStringToProcess = '<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name>RepFirm Test</name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name><![CDATA[THE TOLAND GROUP INC - AGY38598]]></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name>101 Market - 14510</name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc></desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>';
            //prop.execute(); 
            propController.mergeAccountDetailsToSCX(xmlStringToProcess);
            propController.uploadedFile = Blob.valueOf(xmlStringToProcess);
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            propController.populateSelectedRateCard();
            propController.getRateCardsForTIM();
            Test.StopTest();
        }
    }

    static testMethod void rateCardsNotFound() {
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];
        System.runAs(u){

            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c,OwnerId FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1];
            
            UserConnection__c loggedInUser = [SELECT AE_Id__c, TIM_System__c, Username__c FROM UserConnection__c WHERE User__c=: UserInfo.getUserId() AND TIM_System__c ='St. Louis Local' LIMIT 1];

            String timSystem = 'StLouisLocal';
            String partitionName = 'local.TIMAccess';

            Cache.OrgPartition newpart = new Cache.OrgPartition(partitionName);

            Map<String,TIMUserAccess.User> timuserMap = new Map<String,TIMUserAccess.User>();

            timuserMap.put('St. Louis Local', CacheManager.getTIMUser(loggedInUser.Username__c+timSystem,timSystem));

            newpart.put('StLouisLocal', timuserMap);

            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            // String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            ApexPages.currentPage().getParameters().put('recType','_INV');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            String xmlStringToProcess = '<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name>RepFirm Test</name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name><![CDATA[THE TOLAND GROUP INC - AGY38598]]></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name>101 Market - 14510</name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc></desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>';
            //prop.execute(); 
            propController.mergeAccountDetailsToSCX(xmlStringToProcess);
            propController.uploadedFile = Blob.valueOf(xmlStringToProcess);
           
            Test.StartTest();
            propController.verifyTimAccountID();
            propController.xmlParser();
            propController.mergeOpp();
            propController.timServiceCall();
            propController.getRateCardsForTIM();
            Test.StopTest();
        }
    }

    static testMethod void cacheErrorTest() {
        User u = [SELECT Id, Name FROM User WHERE Email = 'adminUser123@charter.com' LIMIT 1];        
        System.runAs(u){

            Opportunity opp = [SELECT Id, Name, Agency_Account__c, Rep_Firm__c,OwnerId FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1];
            
            Proposal__c proposal = new Proposal__c();
            ApexPages.StandardController controller = new ApexPages.StandardController(proposal);
            // String oppId = [SELECT Id, Name FROM Opportunity WHERE Name = 'Test Opportunity' AND PoliticalOpportunity__c = false LIMIT 1].Id;
            Test.setCurrentPage(Page.ProposalSCXUpload);
            ApexPages.currentPage().getParameters().put('OppId', opp.Id);
            ApexPages.currentPage().getParameters().put('isPolitical','false');
            ApexPages.currentPage().getParameters().put('recType','_INV');

            System.assertEquals(true,ApexPages.currentPage().getParameters().get('OppId')!=null);
            
            Test.setMock(WebServiceMock.class, new StratagTimService_Mock());
            Test.setMock(HttpCalloutMock.class, new BoomiWebServiceMock());
            
            //propController = new ProposalSCXUploadController(controller);//commentted by Madhu on Sep19th to avoid ProposalSCXUploadTest: line 65, column 27: Constructor not defined: [ProposalSCXUploadController].<Constructor>(ApexPages.StandardController)
            ProposalSCXUploadController propController = new ProposalSCXUploadController();
            /*ProposalSCXUploadController propCntrl = new ProposalSCXUploadController(opp.Id);
            String xmlStringToProcess = '<?xml version="1.0" encoding="UTF-8"?><adx xsi:noNamespaceSchemaLocation="http://www.spotcable.com/schema/spotcableOrder_101.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><document><schemaVersion>1.0</schemaVersion><name>Hello SCX Order</name><date>2015-05-21</date><mediaType>Spotcable</mediaType><documentType/><documentCode/></document><campaign><key codeOwner="NCC" codeDescription="CampaignID"><id></id></key><key codeOwner="Strata" codeDescription="DMA Override"><id>0</id></key><key codeOwner="Strata" codeDescription="Zone Pops"><id>sum</id></key><key codeOwner="VIEW32" codeDescription="CampaignName"><id></id></key><key codeOwner="Strata" codeDescription="distro"><id>bc</id></key><dateRange><startDate>2014-12-29</startDate><endDate>2015-12-27</endDate></dateRange><company type="Rep"><name>RepFirm Test</name><office><name></name><address><street/><city/><state code="__"/><postalCode>00000</postalCode></address><phone type="voice"></phone></office><contact role="AE"><firstName/><lastName/><email/><phone type="voice"/></contact></company><company type="Agency"><name><![CDATA[THE TOLAND GROUP INC - AGY38598]]></name><contact role="Buyer"><firstName/><lastName/><email/><phone type="voice"></phone></contact><ID><code codeOwner="Agency"></code></ID></company><advertiser><name>101 Market - 14510</name><ID><code codeOwner="Agency"></code></ID></advertiser><product><name></name><ID><code codeOwner="Agency"></code></ID></product><estimate><desc></desc><ID><code codeOwner="Agency"></code></ID></estimate><makeGoodPolicy><code/></makeGoodPolicy><demo demoRank="1"><group>Households</group><ageFrom>0</ageFrom><ageTo>99</ageTo></demo><buyType>weekly</buyType><populations demoRank="1">40425</populations><order><key codeOwner="NCC" codeDescription="Market"><id>180</id></key><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="Pops"><id>zone</id></key><key codeOwner="Strata" codeDescription="UseBroadcastWeeks"><id>1</id></key><totals><cost>12000.00</cost><spots>11</spots></totals><market nsi_id="269"><name>Madison</name></market><survey><ratingService/><geography/><shareBook/><PUTBook/><profile/><comment codeOwner="Spotcable">Feb15 C-DMA Custom Live+1</comment></survey><populations demoRank="1">40425</populations><comment/><systemOrder><key codeOwner=""><id/></key><key codeOwner="Strata" codeDescription="UseZonePop"><id>true</id></key><comment></comment><system><name>Madison East, WI</name><syscode>0397</syscode></system><affiliateSplit/><populations demoRank="1">40425</populations><totals><cost>12000.00</cost><spots>11</spots></totals><weeks count="52"><week number="1" startDate="2014-12-29"/><week number="2" startDate="2015-01-05"/><week number="3" startDate="2015-01-12"/><week number="4" startDate="2015-01-19"/><week number="5" startDate="2015-01-26"/><week number="6" startDate="2015-02-02"/><week number="7" startDate="2015-02-09"/><week number="8" startDate="2015-02-16"/><week number="9" startDate="2015-02-23"/><week number="10" startDate="2015-03-02"/><week number="11" startDate="2015-03-09"/><week number="12" startDate="2015-03-16"/><week number="13" startDate="2015-03-23"/><week number="14" startDate="2015-03-30"/><week number="15" startDate="2015-04-06"/><week number="16" startDate="2015-04-13"/><week number="17" startDate="2015-04-20"/><week number="18" startDate="2015-04-27"/><week number="19" startDate="2015-05-04"/><week number="20" startDate="2015-05-11"/><week number="21" startDate="2015-05-18"/><week number="22" startDate="2015-05-25"/><week number="23" startDate="2015-06-01"/><week number="24" startDate="2015-06-08"/><week number="25" startDate="2015-06-15"/><week number="26" startDate="2015-06-22"/><week number="27" startDate="2015-06-29"/><week number="28" startDate="2015-07-06"/><week number="29" startDate="2015-07-13"/><week number="30" startDate="2015-07-20"/><week number="31" startDate="2015-07-27"/><week number="32" startDate="2015-08-03"/><week number="33" startDate="2015-08-10"/><week number="34" startDate="2015-08-17"/><week number="35" startDate="2015-08-24"/><week number="36" startDate="2015-08-31"/><week number="37" startDate="2015-09-07"/><week number="38" startDate="2015-09-14"/><week number="39" startDate="2015-09-21"/><week number="40" startDate="2015-09-28"/><week number="41" startDate="2015-10-05"/><week number="42" startDate="2015-10-12"/><week number="43" startDate="2015-10-19"/><week number="44" startDate="2015-10-26"/><week number="45" startDate="2015-11-02"/><week number="46" startDate="2015-11-09"/><week number="47" startDate="2015-11-16"/><week number="48" startDate="2015-11-23"/><week number="49" startDate="2015-11-30"/><week number="50" startDate="2015-12-07"/><week number="51" startDate="2015-12-14"/><week number="52" startDate="2015-12-21"/></weeks><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">7000.00</cost><spots>7</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>1</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>1</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>1</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>1</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>TACV</name><ID><code codeOwner="Spotcable" codeDescription="-1">TACV</code></ID><ID><code codeOwner="Strata" codeDescription="Station">TACV</code></ID></network><spotCost currency="USD">2000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">2000.00</cost><spots>1</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>0</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>0</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine><detailLine detailLineID="0"><startTime>06:00:00</startTime><endTime>00:00:00</endTime><startDay>M</startDay><dayOfWeek><Monday>N</Monday><Tuesday>N</Tuesday><Wednesday>N</Wednesday><Thursday>N</Thursday><Friday>N</Friday><Saturday>N</Saturday><Sunday>Y</Sunday></dayOfWeek><length>PT30S</length><daypartCode>RT</daypartCode><program></program><comment>TP</comment><network><name>VDAN</name><ID><code codeOwner="Spotcable" codeDescription="-1">VDAN</code></ID><ID><code codeOwner="Strata" codeDescription="Station">VDAN</code></ID></network><spotCost currency="USD">1000.00</spotCost><demoValue demoRank="1"><value type="Ratings">0.0</value><value type="Impressions">0</value></demoValue><totals><cost currency="USD">3000.00</cost><spots>3</spots></totals><spot><weekNumber>1</weekNumber><quantity>0</quantity></spot><spot><weekNumber>2</weekNumber><quantity>0</quantity></spot><spot><weekNumber>3</weekNumber><quantity>0</quantity></spot><spot><weekNumber>4</weekNumber><quantity>0</quantity></spot><spot><weekNumber>5</weekNumber><quantity>0</quantity></spot><spot><weekNumber>6</weekNumber><quantity>0</quantity></spot><spot><weekNumber>7</weekNumber><quantity>0</quantity></spot><spot><weekNumber>8</weekNumber><quantity>0</quantity></spot><spot><weekNumber>9</weekNumber><quantity>0</quantity></spot><spot><weekNumber>10</weekNumber><quantity>0</quantity></spot><spot><weekNumber>11</weekNumber><quantity>0</quantity></spot><spot><weekNumber>12</weekNumber><quantity>0</quantity></spot><spot><weekNumber>13</weekNumber><quantity>0</quantity></spot><spot><weekNumber>14</weekNumber><quantity>0</quantity></spot><spot><weekNumber>15</weekNumber><quantity>0</quantity></spot><spot><weekNumber>16</weekNumber><quantity>0</quantity></spot><spot><weekNumber>17</weekNumber><quantity>0</quantity></spot><spot><weekNumber>18</weekNumber><quantity>0</quantity></spot><spot><weekNumber>19</weekNumber><quantity>0</quantity></spot><spot><weekNumber>20</weekNumber><quantity>0</quantity></spot><spot><weekNumber>21</weekNumber><quantity>0</quantity></spot><spot><weekNumber>22</weekNumber><quantity>0</quantity></spot><spot><weekNumber>23</weekNumber><quantity>0</quantity></spot><spot><weekNumber>24</weekNumber><quantity>0</quantity></spot><spot><weekNumber>25</weekNumber><quantity>0</quantity></spot><spot><weekNumber>26</weekNumber><quantity>1</quantity></spot><spot><weekNumber>27</weekNumber><quantity>0</quantity></spot><spot><weekNumber>28</weekNumber><quantity>0</quantity></spot><spot><weekNumber>29</weekNumber><quantity>0</quantity></spot><spot><weekNumber>30</weekNumber><quantity>1</quantity></spot><spot><weekNumber>31</weekNumber><quantity>0</quantity></spot><spot><weekNumber>32</weekNumber><quantity>0</quantity></spot><spot><weekNumber>33</weekNumber><quantity>0</quantity></spot><spot><weekNumber>34</weekNumber><quantity>0</quantity></spot><spot><weekNumber>35</weekNumber><quantity>1</quantity></spot><spot><weekNumber>36</weekNumber><quantity>0</quantity></spot><spot><weekNumber>37</weekNumber><quantity>0</quantity></spot><spot><weekNumber>38</weekNumber><quantity>0</quantity></spot><spot><weekNumber>39</weekNumber><quantity>0</quantity></spot><spot><weekNumber>40</weekNumber><quantity>0</quantity></spot><spot><weekNumber>41</weekNumber><quantity>0</quantity></spot><spot><weekNumber>42</weekNumber><quantity>0</quantity></spot><spot><weekNumber>43</weekNumber><quantity>0</quantity></spot><spot><weekNumber>44</weekNumber><quantity>0</quantity></spot><spot><weekNumber>45</weekNumber><quantity>0</quantity></spot><spot><weekNumber>46</weekNumber><quantity>0</quantity></spot><spot><weekNumber>47</weekNumber><quantity>0</quantity></spot><spot><weekNumber>48</weekNumber><quantity>0</quantity></spot><spot><weekNumber>49</weekNumber><quantity>0</quantity></spot><spot><weekNumber>50</weekNumber><quantity>0</quantity></spot><spot><weekNumber>51</weekNumber><quantity>0</quantity></spot><spot><weekNumber>52</weekNumber><quantity>0</quantity></spot></detailLine></systemOrder></order></campaign></adx>';
            //prop.execute(); 
            propController.mergeAccountDetailsToSCX(xmlStringToProcess);
            propController.uploadedFile = Blob.valueOf(xmlStringToProcess);*/
           
            Test.StartTest();
            propController.verifyTimAccountID();
            Test.StopTest();
        }
    }
}